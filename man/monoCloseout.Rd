% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/splitMono.R
\name{monoCloseout}
\alias{monoCloseout}
\title{blend the Sprague upper boundary age estimates into monotonic spline estimates}
\usage{
monoCloseout(popmat, pops, pivotAge = 90, splitfun = spragueSimple,
  OAG = FALSE, ...)
}
\arguments{
\item{popmat}{a numeric matrix of population counts in 5-year age groups, with integer-labeled 
margins (age in rows and year in columns).}

\item{pops}{optional numeric matrix of single age population counts derived from \code{popmat}.}

\item{pivotAge}{integer (default 90). Age at which to switch to spline-based estimates.}

\item{splitfun}{optional. The function used to create pops. Default \code{spragueSimple}. 
Could also be \code{grabill}, \code{beersModSimple}, or any other function that similarly transforms.}

\item{OAG}{logical (default \code{FALSE}). Would we like to re-impute the last 
element of \code{Value} as the open age group?}

\item{...}{arguments to be optionally passed to \code{splitfun()}.}
}
\value{
numeric matrix of age by year estimates of single-age counts.
}
\description{
A simple monotonic spline on the cumulative sum of population counts
may return more convincing single age count estimates than the Sprague or other splitting methods.
This function blends the given single age population estimates starting at \code{pivotAge}.
}
\details{
The \code{pivotAge} must be at least 10 years below the maximum age detected from 
\code{rownames(popmat)}, but not lower than 80. In the exact \code{pivotAge}, we may either take
the Sprague estimates or the spline estimates, depending on which is larger, then the single-age estimates
for this 5-year age group are rescaled to sum to the original total in \code{popmat}. Higher ages are taken from
the spline-based age splits. The spline results are derive from the \code{"monoH.FC"} method of \code{splinefun()} 
on the cumulative sum of the original age grouped data. One could use this function to perform the same
closeout to Grabill estimates, if these are given via the \code{pops} argument. See examples. Note
that the Grabill split method mixed with this closeout will not necessarily preserve the annual totals,
and this function performs to rescaling. The open age group is preserved (and must be included in \code{popmat}).
}
\examples{
 popmat <- structure(c(54170, 44775, 42142, 38464, 34406, 30386, 26933, 
23481, 20602, 16489, 14248, 9928, 8490, 4801, 3599, 2048, 941, 
326, 80, 17, 0, 57424, 44475, 41752, 39628, 34757, 30605, 27183, 
23792, 20724, 17056, 14059, 10585, 8103, 5306, 3367, 2040, 963, 
315, 80, 16, 1, 60272, 44780, 41804, 40229, 35155, 30978, 27456, 
24097, 20873, 17546, 13990, 11146, 7841, 5738, 3184, 2062, 961, 
311, 80, 15, 1, 62727, 45681, 42101, 40474, 35599, 31439, 27758, 
24396, 21055, 17958, 14046, 11589, 7731, 6060, 3086, 2083, 949, 
312, 79, 14, 1, 64816, 47137, 42508, 40532, 36083, 31940, 28092, 
24693, 21274, 18299, 14223, 11906, 7785, 6255, 3090, 2084, 938, 
316, 80, 14, 2), .Dim = c(21L, 5L), .Dimnames = list(c("0", "5", 
"10", "15", "20", "25", "30", "35", "40", "45", "50", "55", "60", 
"65", "70", "75", "80", "85", "90", "95", "100"), c("1950", "1951", 
"1952", "1953", "1954")))

closed.out <- monoCloseout(popmat)
colSums(closed.out) - colSums(popmat)
monoCloseout(popmat, pivotAge = 85)
# giving a different single-age split to close out this way:
popg <- grabill(popmat)
grabill.closed.out <- monoCloseout(popmat, popg)
# totals not necessarily preserved if mixed w Grabill
# I wouldn't recommend a rescale of the total, since the 
# only part we mess with here is the old age section. Ergo,
# one may wish to instead rescale results colSums() of 
# popg at age pivotAge and higher.
colSums(grabill.closed.out) - colSums(popmat)
# also works on an age-labelled vector of data
popvec <- popmat[,1]
closed.vec <- monoCloseout(popvec)
# let's compare this one with spragueSimple()
simple.vec <- spragueSimple(popvec)
# and with a simple monotonic spline
mono.vec <- splitMono(popvec)
\dontrun{
plot(85:100,simple.vec[86:101], type = 'l', main = "In this case spragueSimple() is the smoothest")
lines(85:100,closed.vec[86:101], col = "red", lwd = 2)
lines(85:100,mono.vec[86:101], col = "blue", lty = 2)
legend("topright",lty=c(1,2,2), col = c("black","red","blue"),lwd = c(1,2,1),
		legend = c("spragueSimple()","monoCloseout()", "splitMono()"))
}
}
